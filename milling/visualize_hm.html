<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>heightmap visualize</title>
        <script src="hm.js"></script>
        <script src="curvedebug1.js"></script>
        <script src="curvedebug2.js"></script>
        <script>
            const sign_curves = "M 0.47128951,5.0006394 V 0.45518052 H 1.3766606 L 2.4525639,3.6735887 Q 2.601392,4.1231736 2.6696049,4.3464158 2.7471196,4.0983689 2.9114506,3.6177781 L 3.9997563,0.45518052 H 4.8090092 V 5.0006394 H 4.2291996 V 1.1962206 L 2.90835,5.0006394 H 2.3657475 L 1.0510991,1.1311082 V 5.0006394 Z M 7.856885,4.5944627 Q 7.5468264,4.8580125 7.2584719,4.966533 6.973218,5.0750535 6.6445559,5.0750535 q -0.5426025,0 -0.8340576,-0.2635498 -0.2914551,-0.2666504 -0.2914551,-0.6790283 0,-0.2418457 0.1085205,-0.4402832 0.1116211,-0.2015381 0.2883545,-0.3224609 0.179834,-0.1209229 0.4030762,-0.1829346 0.164331,-0.043408 0.4960937,-0.083716 0.6759278,-0.080615 0.9952881,-0.1922364 0.0031,-0.1147216 0.0031,-0.1457275 0,-0.3410644 -0.1581299,-0.4805908 -0.2139404,-0.1891357 -0.6356201,-0.1891357 -0.3937744,0 -0.5829101,0.1395263 -0.1860352,0.1364258 -0.2759522,0.486792 L 5.6151614,2.6472947 Q 5.6895755,2.2969285 5.8601077,2.0829881 6.0306399,1.8659471 6.3531008,1.7512254 6.6755618,1.6334032 7.100342,1.6334032 q 0.4216797,0 0.6852295,0.099219 0.2635498,0.099219 0.3875733,0.2511475 0.1240234,0.1488281 0.1736328,0.3782714 0.027905,0.142627 0.027905,0.5146973 v 0.7441406 q 0,0.7782471 0.034107,0.9859863 0.037207,0.2046387 0.1426269,0.3937744 H 7.9685061 Q 7.8816897,4.8270066 7.856885,4.5944627 Z M 7.8103762,3.3480272 Q 7.5065188,3.4720506 6.898804,3.558867 6.5546389,3.6084764 6.412012,3.6704881 6.269385,3.7324998 6.1918704,3.8534227 q -0.077515,0.1178222 -0.077515,0.2635498 0,0.2232421 0.1674317,0.3720703 0.1705322,0.1488281 0.4960937,0.1488281 0.3224609,0 0.5736084,-0.1395264 Q 7.602637,4.3557176 7.7204592,4.1107713 7.8103762,3.9216355 7.8103762,3.5526658 Z m 3.5780768,0.4464843 0.548803,0.071314 q -0.08992,0.5674072 -0.461987,0.8898682 -0.36897,0.3193603 -0.908472,0.3193603 -0.6759274,0 -1.0883053,-0.4402832 -0.4092774,-0.4433838 -0.4092774,-1.2681396 0,-0.5333008 0.1767334,-0.9332764 0.1767334,-0.3999756 0.5364014,-0.5984131 0.3627689,-0.201538 0.7875489,-0.201538 0.536401,0 0.877466,0.2728515 0.341064,0.269751 0.437182,0.7689453 l -0.542602,0.083716 q -0.07752,-0.3317627 -0.275952,-0.4991943 -0.195337,-0.1674316 -0.47439,-0.1674316 -0.42168,0 -0.6852295,0.3038574 -0.2635498,0.3007568 -0.2635498,0.9549804 0,0.6635254 0.2542481,0.9642823 0.2542482,0.3007568 0.6635252,0.3007568 0.328662,0 0.548804,-0.2015381 0.220141,-0.2015381 0.279053,-0.6201172 z M 12.417846,1.0970018 V 0.45518052 h 0.558106 V 1.0970018 Z m 0,3.9036376 V 1.7078172 h 0.558106 v 3.2928222 z m 3.661792,-1.0604003 0.576709,0.071313 q -0.136425,0.5053955 -0.505395,0.7844483 -0.36897,0.2790527 -0.942578,0.2790527 -0.722437,0 -1.147217,-0.4433838 -0.42168,-0.4464844 -0.42168,-1.2495361 0,-0.830957 0.427881,-1.2898437 0.427881,-0.4588867 1.11001,-0.4588867 0.660425,0 1.079004,0.4495849 0.418579,0.449585 0.418579,1.2650391 0,0.049609 -0.0031,0.1488281 h -2.455664 q 0.03101,0.5426025 0.306958,0.830957 0.275952,0.2883545 0.68833,0.2883545 0.306958,0 0.523999,-0.1612305 0.217041,-0.1612304 0.344165,-0.5146972 z M 14.247192,3.0379686 h 1.838647 Q 16.048632,2.6224901 15.875,2.4147508 15.608349,2.0922899 15.183569,2.0922899 q -0.384473,0 -0.648022,0.2573486 -0.26045,0.2573486 -0.288355,0.6883301 z M 17.35398,1.103203 V 0.45518052 h 0.558106 V 1.103203 Z m -0.706933,5.1748778 0.10542,-0.4743896 q 0.167431,0.043408 0.263549,0.043408 0.170533,0 0.254249,-0.1147217 0.08372,-0.1116211 0.08372,-0.5643066 V 1.7078172 h 0.558106 v 3.4726562 q 0,0.6077149 -0.15813,0.84646 -0.201538,0.3100586 -0.669727,0.3100586 -0.226342,0 -0.437182,-0.058911 z M 20.603394,5.0006394 V 0.45518052 h 1.714624 q 0.452685,0 0.69143,0.0434082 0.334864,0.0558106 0.561206,0.21394043 0.226343,0.1550293 0.362769,0.43718265 0.139526,0.2821533 0.139526,0.6201171 0,0.5798096 -0.368969,0.9828858 -0.36897,0.3999755 -1.333252,0.3999755 h -1.165821 v 1.8479492 z m 0.601513,-2.3843505 h 1.175122 q 0.58291,0 0.827857,-0.217041 0.244946,-0.217041 0.244946,-0.6108154 0,-0.2852539 -0.145727,-0.486792 -0.142627,-0.2046387 -0.378272,-0.269751 -0.151929,-0.0403076 -0.561206,-0.0403076 h -1.16272 z M 24.77058,1.0970018 V 0.45518052 h 0.558105 V 1.0970018 Z m 0,3.9036376 V 1.7078172 h 0.558105 v 3.2928222 z m 3.661792,-1.0604003 0.576709,0.071313 q -0.136426,0.5053955 -0.505396,0.7844483 -0.368969,0.2790527 -0.942578,0.2790527 -0.722436,0 -1.147216,-0.4433838 -0.42168,-0.4464844 -0.42168,-1.2495361 0,-0.830957 0.427881,-1.2898437 0.427881,-0.4588867 1.110009,-0.4588867 0.660425,0 1.079004,0.4495849 0.418579,0.449585 0.418579,1.2650391 0,0.049609 -0.0031,0.1488281 H 26.56892 q 0.03101,0.5426025 0.306958,0.830957 0.275952,0.2883545 0.68833,0.2883545 0.306958,0 0.523999,-0.1612305 0.217041,-0.1612304 0.344165,-0.5146972 z M 26.599926,3.0379686 h 1.838647 q -0.03721,-0.4154785 -0.21084,-0.6232178 -0.26665,-0.3224609 -0.69143,-0.3224609 -0.384473,0 -0.648023,0.2573486 -0.260449,0.2573486 -0.288354,0.6883301 z m 1.438672,1.9626708 q -0.176734,0.1085205 -0.275953,0.2666504 -0.09612,0.1612305 -0.09612,0.3255615 0,0.1302247 0.07131,0.2201416 0.07131,0.089917 0.232544,0.089917 0.07131,0 0.145727,-0.021704 0.07441,-0.018604 0.136426,-0.05271 v 0.396875 q -0.226343,0.1085205 -0.42168,0.1085205 -0.15813,0 -0.275952,-0.046509 -0.117822,-0.043408 -0.198437,-0.1240235 -0.07752,-0.077515 -0.117823,-0.1798339 -0.03721,-0.1023194 -0.03721,-0.2201416 0,-0.1984375 0.111621,-0.3999756 0.111622,-0.1984375 0.31626,-0.3627686 z m 2.889747,-0.4991943 0.08061,0.4929932 q -0.235645,0.049609 -0.42168,0.049609 -0.303857,0 -0.471289,-0.096118 Q 29.94856,4.8518113 29.880347,4.696782 29.812134,4.5386521 29.812134,4.0363572 v -1.894458 h -0.409277 v -0.434082 h 0.409277 V 0.89236313 L 30.367139,0.55749986 V 1.7078172 h 0.561206 v 0.434082 h -0.561206 v 1.9254639 q 0,0.2387451 0.0279,0.306958 0.03101,0.068213 0.09612,0.1085205 0.06821,0.040308 0.192236,0.040308 0.09302,0 0.244947,-0.021704 z m 0.548803,0.4991943 V 0.45518052 h 0.558105 V 3.0472703 l 1.32085,-1.3394531 h 0.722436 l -1.258838,1.2216309 1.385962,2.0711913 h -0.68833 L 32.429028,3.3170213 32.035253,3.6952928 v 1.3053466 z m 5.320606,-0.4061767 q -0.310058,0.2635498 -0.598413,0.3720703 -0.285254,0.1085205 -0.613916,0.1085205 -0.542602,0 -0.834057,-0.2635498 -0.291455,-0.2666504 -0.291455,-0.6790283 0,-0.2418457 0.10852,-0.4402832 0.111621,-0.2015381 0.288355,-0.3224609 0.179834,-0.1209229 0.403076,-0.1829346 0.164331,-0.043408 0.496093,-0.083716 0.675928,-0.080615 0.995289,-0.1922364 0.0031,-0.1147216 0.0031,-0.1457275 0,-0.3410644 -0.15813,-0.4805908 -0.21394,-0.1891357 -0.63562,-0.1891357 -0.393774,0 -0.58291,0.1395263 -0.186035,0.1364258 -0.275952,0.486792 l -0.545703,-0.074414 q 0.07441,-0.3503662 0.244946,-0.5643066 0.170532,-0.217041 0.492993,-0.3317627 0.322461,-0.1178222 0.747241,-0.1178222 0.42168,0 0.68523,0.099219 0.26355,0.099219 0.387573,0.2511475 0.124024,0.1488281 0.173633,0.3782714 0.0279,0.142627 0.0279,0.5146973 v 0.7441406 q 0,0.7782471 0.03411,0.9859863 0.03721,0.2046387 0.142627,0.3937744 H 36.909375 Q 36.822559,4.8270066 36.797754,4.5944627 Z m -0.04651,-1.2464355 q -0.303858,0.1240234 -0.911573,0.2108398 -0.344165,0.049609 -0.486792,0.1116211 -0.142627,0.062012 -0.220141,0.1829346 -0.07751,0.1178222 -0.07751,0.2635498 0,0.2232421 0.167432,0.3720703 0.170532,0.1488281 0.496093,0.1488281 0.322461,0 0.573609,-0.1395264 0.251147,-0.1426269 0.36897,-0.3875732 0.08992,-0.1891358 0.08992,-0.5581055 z m 5.971727,1.1162109 v 0.5364013 h -3.004468 q -0.0062,-0.201538 0.06511,-0.3875732 0.114722,-0.306958 0.365869,-0.6046142 0.254248,-0.2976563 0.731738,-0.6883301 0.741041,-0.6077148 1.00149,-0.9611816 0.260449,-0.3565674 0.260449,-0.6728272 0,-0.3317627 -0.238745,-0.5581054 -0.235645,-0.2294434 -0.617017,-0.2294434 -0.403076,0 -0.644922,0.2418457 -0.241845,0.2418457 -0.244946,0.6697266 l -0.573608,-0.058911 q 0.05891,-0.6418213 0.443383,-0.97668453 0.384473,-0.33796386 1.032496,-0.33796386 0.654223,0 1.035595,0.36276855 0.381372,0.36276854 0.381372,0.89916994 0,0.2728515 -0.111621,0.5364013 -0.111621,0.2635498 -0.37207,0.5550049 -0.257349,0.2914551 -0.858862,0.7999512 -0.502295,0.4216796 -0.644922,0.5736083 -0.142627,0.1488282 -0.235645,0.3007569 z m 0.598412,-1.7053223 q 0,-0.8061523 0.164331,-1.2960449 0.167432,-0.49299312 0.492993,-0.75964351 0.328662,-0.26665038 0.824756,-0.26665038 0.365869,0 0.641821,0.14882812 0.275952,0.14572754 0.455786,0.42478027 0.179834,0.2759521 0.282154,0.6759277 0.102319,0.396875 0.102319,1.0728027 0,0.7999512 -0.164331,1.2929444 -0.164331,0.4898925 -0.492993,0.7596435 -0.325562,0.2666504 -0.824756,0.2666504 -0.657324,0 -1.032495,-0.4712891 -0.449585,-0.5674072 -0.449585,-1.8479492 z m 0.573608,0 q 0,1.1193115 0.260449,1.4913819 0.26355,0.3689697 0.648023,0.3689697 0.384473,0 0.644922,-0.3720703 0.26355,-0.3720703 0.26355,-1.4882813 0,-1.1224121 -0.26355,-1.4913818 -0.260449,-0.3689697 -0.651123,-0.3689697 -0.384473,0 -0.613916,0.3255615 -0.288355,0.4154785 -0.288355,1.53479 z m 5.891117,1.7053223 v 0.5364013 h -3.004468 q -0.0062,-0.201538 0.06511,-0.3875732 0.114722,-0.306958 0.365869,-0.6046142 0.254248,-0.2976563 0.731739,-0.6883301 0.74104,-0.6077148 1.001489,-0.9611816 0.260449,-0.3565674 0.260449,-0.6728272 0,-0.3317627 -0.238745,-0.5581054 -0.235645,-0.2294434 -0.617017,-0.2294434 -0.403076,0 -0.644922,0.2418457 -0.241845,0.2418457 -0.244946,0.6697266 l -0.573608,-0.058911 q 0.05891,-0.6418213 0.443384,-0.97668453 0.384472,-0.33796386 1.032495,-0.33796386 0.654223,0 1.035595,0.36276855 0.381372,0.36276854 0.381372,0.89916994 0,0.2728515 -0.111621,0.5364013 -0.111621,0.2635498 -0.37207,0.5550049 -0.257349,0.2914551 -0.858862,0.7999512 -0.502295,0.4216796 -0.644922,0.5736083 -0.142627,0.1488282 -0.235645,0.3007569 z m 0.601513,-0.6635254 0.558105,-0.074414 q 0.09612,0.4743897 0.325562,0.6852295 0.232543,0.2077393 0.564306,0.2077393 0.393775,0 0.663526,-0.2728516 0.272851,-0.2728515 0.272851,-0.6759277 0,-0.3844727 -0.251147,-0.6325195 -0.251148,-0.2511475 -0.638721,-0.2511475 -0.15813,0 -0.393774,0.062012 l 0.06201,-0.4898925 q 0.05581,0.0062 0.08992,0.0062 0.356568,0 0.641822,-0.1860351 0.285253,-0.1860352 0.285253,-0.5736084 0,-0.306958 -0.207739,-0.5084961 -0.207739,-0.20153808 -0.536401,-0.20153808 -0.325562,0 -0.542603,0.20463868 -0.217041,0.2046387 -0.279052,0.613916 l -0.558106,-0.099219 q 0.102319,-0.561206 0.465088,-0.868164 0.362769,-0.31005859 0.90227,-0.31005859 0.372071,0 0.68523,0.16123046 0.313159,0.15812988 0.47749,0.43408203 0.167432,0.2759521 0.167432,0.5860107 0,0.2945557 -0.15813,0.5364014 -0.15813,0.2418457 -0.468189,0.3844726 0.403077,0.093018 0.626319,0.3875733 0.223242,0.2914551 0.223242,0.7317382 0,0.5953125 -0.434082,1.010791 -0.434082,0.412378 -1.097607,0.412378 -0.598414,0 -0.995289,-0.3565674 -0.393774,-0.3565674 -0.449584,-0.9239746 z";

            const sign_curves2 = "m 28.263106,5.5545076 c -0.802068,0.2659984 -0.752192,0.8814713 -0.04747,1.2185103 m 9.560907,-4.0104101 v 2.8044337 m 0,-2.200304 c 0,0 -0.226719,-0.2944815 -0.372074,-0.4069926 -0.110991,-0.085912 -0.235857,-0.1632812 -0.372069,-0.1971371 -0.181497,-0.045112 -0.379712,-0.045715 -0.561058,0 -0.134415,0.033884 -0.256495,0.1123536 -0.366164,0.1971371 -0.146477,0.1132396 -0.285527,0.2465807 -0.377976,0.4069926 -0.104057,0.180554 -0.152228,0.3916742 -0.183082,0.5977705 -0.01977,0.1320727 -0.01967,0.2685461 0,0.4006334 0.03085,0.2071216 0.07794,0.419852 0.183082,0.60095 0.09218,0.1587781 0.232659,0.2884238 0.377976,0.4006334 0.110118,0.08503 0.231374,0.1658568 0.366164,0.2003167 0.181192,0.046323 0.379712,0.045715 0.561058,0 0.136582,-0.034431 0.260632,-0.1141658 0.372069,-0.2003167 0.144188,-0.1114703 0.37207,-0.4006334 0.37207,-0.4006334 m -5.214883,-3.60888 v 4.2098301 m 1.866255,-2.8044337 -1.866255,2.0031669 m 0.74414,-0.8012667 1.305197,1.6025335 M 30.518225,1.3572114 c 0,0 -0.03,2.2697101 0,3.4085633 0.0055,0.2099164 0.05574,0.4386565 0.188988,0.6009501 0.08828,0.1075255 0.231374,0.1658568 0.366164,0.2003167 0.122066,0.031207 0.377976,0 0.377976,0 m -1.48828,-2.8044337 h 1.299292 M 26.797572,3.964508 h 2.232419 c 0,0 0.0284,-0.2701443 0,-0.4006334 C 28.998763,3.4204059 28.928421,3.2853651 28.846909,3.1632412 28.795517,3.0862441 28.731347,3.016121 28.657921,2.9597449 28.546594,2.8742691 28.422064,2.7964637 28.285852,2.7626078 c -0.181497,-0.045112 -0.379712,-0.045715 -0.561058,0 -0.134415,0.033884 -0.256495,0.1123536 -0.366164,0.1971371 -0.146477,0.1132396 -0.285527,0.2465807 -0.377976,0.4069926 -0.104057,0.180554 -0.152228,0.3916742 -0.183082,0.5977705 -0.01977,0.1320727 -0.01967,0.2685461 0,0.4006334 0.03085,0.2071216 0.07794,0.419852 0.183082,0.60095 0.09218,0.1587781 0.232659,0.2884238 0.377976,0.4006334 0.110118,0.08503 0.231374,0.1658568 0.366164,0.2003167 0.181192,0.046323 0.561058,0 0.561058,0 0,0 0.260632,-0.1141658 0.372069,-0.2003167 0.144188,-0.1114703 0.37207,-0.4006334 0.37207,-0.4006334 m -3.720698,-3.60888 0.183082,0.2034963 0.188988,-0.2034963 -0.188988,-0.1971371 -0.183082,0.1971371 m 0.183082,1.4053964 V 5.5670415 M 21.582596,1.3572114 v 4.2098301 m 0,-4.2098301 c 0,0 1.126783,-0.097714 1.677267,0 0.194058,0.034446 0.391036,0.094359 0.555152,0.2034963 0.07708,0.051261 0.136892,0.1269735 0.188988,0.2034963 0.08202,0.1204746 0.156687,0.2521559 0.188988,0.3942741 0.04463,0.1963684 0.04402,0.4076238 0,0.6041297 -0.03228,0.1440858 -0.106273,0.2783192 -0.188988,0.4006334 -0.05186,0.076684 -0.111645,0.1526265 -0.188988,0.2034963 -0.164066,0.1079088 -0.361631,0.1637969 -0.555152,0.1971371 -0.550972,0.094923 -1.677267,0 -1.677267,0 M 17.678862,1.3572114 17.86785,1.5607077 18.050932,1.3572114 17.86785,1.1600743 17.678862,1.3572114 m 0.188988,1.4053964 c 0,0 -0.01237,2.3169725 0,3.4053838 0.0024,0.2099756 -0.05466,0.43955 -0.188988,0.60095 -0.08979,0.1078797 -0.235858,0.1632812 -0.37207,0.1971371 -0.120361,0.029916 -0.372069,0 -0.372069,0 M 13.958117,3.964508 h 2.232419 c 0,0 0.0284,-0.2701443 0,-0.4006334 C 16.159308,3.4204059 16.088966,3.2853651 16.007454,3.1632412 15.956062,3.0862441 15.891892,3.016121 15.818466,2.9597449 15.707139,2.8742691 15.582609,2.7964637 15.446397,2.7626078 c -0.181497,-0.045112 -0.379712,-0.045715 -0.561058,0 -0.134415,0.033884 -0.256495,0.1123536 -0.366164,0.1971371 -0.146477,0.1132396 -0.285527,0.2465807 -0.377976,0.4069926 -0.104057,0.180554 -0.152228,0.3916742 -0.183082,0.5977705 -0.01977,0.1320727 -0.01967,0.2685461 0,0.4006334 0.03085,0.2071216 0.07794,0.419852 0.183082,0.60095 0.09218,0.1587781 0.232659,0.2884238 0.377976,0.4006334 0.110118,0.08503 0.231374,0.1658568 0.366164,0.2003167 0.181192,0.046323 0.379712,0.045715 0.561058,0 0.136582,-0.034431 0.260632,-0.1141658 0.372069,-0.2003167 0.144188,-0.1114703 0.37207,-0.4006334 0.37207,-0.4006334 m -3.720699,-3.60888 0.183082,0.2034963 0.188988,-0.2034963 -0.188988,-0.1971371 -0.183082,0.1971371 m 0.183082,1.4053964 v 2.8044337 m -1.299244,-2.200304 c 0,0 -0.226716,-0.2944817 -0.37207,-0.4069926 -0.110991,-0.085912 -0.235858,-0.1632812 -0.37207,-0.1971371 -0.181497,-0.045112 -0.379712,-0.045715 -0.561058,0 -0.1344146,0.033884 -0.2564951,0.1123536 -0.3661636,0.1971371 -0.146477,0.1132397 -0.285527,0.2465807 -0.3779757,0.4069926 -0.104057,0.180554 -0.1522283,0.3916742 -0.183082,0.5977705 -0.019772,0.1320727 -0.019674,0.2685461 0,0.4006334 0.03085,0.2071216 0.077941,0.419852 0.183082,0.60095 0.092182,0.158778 0.2326585,0.2884237 0.3779757,0.4006334 0.1101174,0.085029 0.2313736,0.1658568 0.3661636,0.2003167 0.181192,0.046323 0.379712,0.045715 0.561058,0 0.136583,-0.034431 0.260632,-0.1141657 0.37207,-0.2003167 0.144188,-0.1114703 0.37207,-0.4006334 0.37207,-0.4006334 M 7.821964,2.7626078 v 2.8044337 m 0,-2.200304 c 0,0 -0.2267156,-0.2944817 -0.3720698,-0.4069926 -0.110991,-0.085912 -0.235858,-0.1632812 -0.3720698,-0.1971371 -0.1814969,-0.045112 -0.3797118,-0.045715 -0.5610577,0 C 6.382352,2.7964919 6.2602714,2.8749614 6.1506028,2.9597449 6.0041258,3.0729845 5.8650758,3.2063256 5.7726271,3.3667375 5.6685701,3.5472915 5.6203988,3.7584117 5.5895451,3.964508 c -0.019772,0.1320727 -0.019674,0.2685461 0,0.4006334 0.03085,0.2071216 0.077941,0.419852 0.183082,0.60095 0.092182,0.158778 0.2326585,0.2884238 0.3779757,0.4006334 0.1101175,0.08503 0.2313738,0.1658568 0.3661639,0.2003167 0.1811916,0.046323 0.3797117,0.045715 0.5610577,0 C 7.2144071,5.5326109 7.3384567,5.4528758 7.4498942,5.3667248 7.5940825,5.2552545 7.821964,4.9660914 7.821964,4.9660914 m -6.5141751,-3.60888 v 4.2098301 m 0,-4.2098301 1.4882792,4.2098301 M 4.2843474,1.3572114 2.7960681,5.5670415 M 4.2843474,1.3572114 v 4.2098301";

            const logo_curves = "M 220,662 V 0 M -472.99213,662 V 0 m 0,662 L -30.992126,0 m 0,662 V 0 m -725.000004,662 31,-32 32,32 -32,31 -31,-31 m 31,-221 V 0 M -1480.9921,662 V 0 m 0,662 252,-662 M -976.99213,662 -1228.9921,0 m 251.99997,662 V 0 m 1740.21676,132.91009 38.80278,-28.59155 m 530.98509,-170.527791 -45.9507,-31.654891 m 378.8372,468.696322 6.1268,-40.84504 M 1347.3081,827.2749 c 10.2108,1.01952 41.8661,-2.04189 41.8661,-2.04189 M 824.83113,709.18267 811.23599,668.0349 m 122.14946,-293.42782 527.81435,2.16681 m -269.2267,268.31782 -2.8162,-538.08137 m 64.128,531.25095 c 0,0 202.4045,-268.69672 2.3849,-515.64841 M 1140.437,635.88451 c 0,0 -214.72508,-236.02072 -7.3135,-518.71176 M 927.20275,371.37906 c -3.06245,196.98327 152.77595,273.83654 268.97885,274.13569 130.7195,0.33554 270.42,-86.51887 271.6192,-269.577 1.4119,-215.47446 -184.8235,-269.57686 -278.767,-269.57686 -103.1338,0 -261.83105,66.91988 -261.83105,265.01817 z M 811.21756,350.41294 c 0,0 66.17627,-455.20012 570.80884,-578.97783 216.4783,-53.09849 342.0768,120.49265 324.7177,305.316345 M 1027.6959,712.91213 c 0,0 -462.92286,-280.05329 -340.03444,-778.09702 43.39077,-175.85464 274.68252,-196.05659 375.77394,-148.06319 m 414.5767,848.55481 c 0,0 -399.905,337.85078 -802.6041,119.47157 C 391.53057,600.83482 532.45059,413.72251 595.7602,313.65248 m 1036.4416,471.75963 c 0,0 395.968,-97.43289 160.3168,-472.78086 C 1641.6413,72.312399 1317.6955,-32.508818 1113.4706,8.3360247 M 924.69973,921.77152 c 0,0 207.90547,330.74658 471.61877,53.67914 206.1968,-216.63827 225.9486,-466.57337 120.5726,-788.00697"
        
            const logo_curves2 = "M 84.255673,662 V 0 M -614.61974,662 V 0 m 0,662 L -168.8673,0 m 0,662 V 0 m -731.15502,662 31.26318,-32 32.27167,32 -32.27167,31 -31.26318,-31 m 31.26318,-221 V 0 M -1631.1773,662 V 0 m 0,662 254.1394,-662 m 254.1394,662 -254.1394,-662 m 254.1394,662 V 0 m 1958.4312,-230.88352 55.55712,-40.93686 m 760.25468,-244.15857 -65.7913,-45.32289 m 542.4121,671.07082 8.7723,-58.481186 M 1671.8128,763.29531 c 14.6196,1.45974 59.943,-2.92353 59.943,-2.92353 M 923.73977,594.21302 904.27449,535.2984 m 174.89131,-420.12459 755.715,3.1024 m -385.4739,384.17255 -4.0322,-770.41506 m 91.8174,760.63539 c 0,0 289.7989,-384.71505 3.4146,-738.29596 m -164.9882,734.89292 c 0,0 -307.4395,-337.93014 -10.4714,-742.682 m -294.8336,363.96794 c -4.3847,282.03705 218.7418,392.07415 385.1191,392.50247 187.1618,0.48042 387.1824,-123.87614 388.8993,-385.97542 2.0216,-308.51239 -264.6268,-385.97522 -399.1335,-385.97522 -147.665,0 -374.8849,95.81467 -374.8849,379.44817 z M 904.24811,80.533083 c 0,0 94.74997,-651.747203 817.27359,-828.969863 309.9497,-76.02545 489.7794,172.51917 464.9249,437.14635 M 1214.1978,599.5528 c 0,0 -662.80445,-400.97518 -486.85505,-1114.06508 62.1261,-251.78546 393.28545,-280.71024 538.02635,-211.99417 M 1858.9524,488.4388 c 0,0 -572.5768,483.72857 -1149.15394,171.05721 C 303.34796,439.08256 505.11465,171.17857 595.7602,27.900135 M 2079.7183,703.35694 c 0,0 566.9398,-139.50263 229.5387,-676.918984 C 2093.2336,-317.64619 1629.4139,-467.72729 1337.0085,-409.24639 M 1066.7298,898.59385 c 0,0 297.6753,473.55685 675.2551,76.85681 295.2289,-310.17872 323.5091,-668.03122 172.6337,-1128.25397";
        </script>
        <script>
            'use strict';

            const heightmap_visualize = (heightmap, width, height) => {
                const canvas = document.createElement("canvas");

                canvas.width = width;
                canvas.height = height;

                const ctx = canvas.getContext('2d');
                const image_data = ctx.createImageData(width, height);
                const data = image_data.data;

                for (let i = 0; i < width*height; ++i) {
                    const index = i * 4;
                    const color = Math.floor(Math.max(Math.min(heightmap[i]*255, 255), 0));

                    data[index + 0] = color;
                    data[index + 1] = color;
                    data[index + 2] = color;
                    data[index + 3] = 255;
                }

                ctx.putImageData(image_data, 0, 0);
                return canvas;
            };

            const curve_visualize = (curve, to) => {
                const canvas = document.createElement("canvas");

                canvas.width = 1500;
                canvas.height = 1500;

                const parse_point = (point) => {
                    return { x: point[0]*canvas.width, y: point[1]*canvas.height };  
                };

                const ctx = canvas.getContext('2d');  
                
                ctx.beginPath();
                const start = parse_point(curve[0]);

                ctx.moveTo(start.x, start.y);

                for (let i = 1; i < Math.min(curve.length, to); ++i) {
                    const point = parse_point(curve[i]);
                    ctx.lineTo(point.x, point.y);
                }

                ctx.stroke();
                return canvas;
            };

            const milling_signature = (cw, ch, paths) => {
                const canvas = document.createElement("canvas");

                canvas.width = cw;
                canvas.height = ch;

                const ctx = canvas.getContext('2d');  
                ctx.fillStyle = '#fff';
                ctx.fillRect(0,0,cw,ch);

                ctx.beginPath();

                const gen_paths = (width, height, data, sx, sy, tx, ty) => {
                    let commands = data.split(/\s+/);

                    const read_point = () => {
                        const d = commands.shift();
                        let [x,y] = d.split(',');

                        x = parseFloat(x);
                        y = parseFloat(y);

                        return {x,y};
                    };

                    const read_points = () => {
                        const points = [];
                        while(commands.length > 0) {
                            const d = commands[0];
                            let [x,y] = d.split(',');

                            if (y === undefined) {
                                break;
                            }

                            x = parseFloat(x);
                            y = parseFloat(y);

                            points.push({x, y});
                            commands.shift();
                        }
                        return points;
                    };

                    const quadratic_bezier = (p0, p1, p2, steps = 20) => {
                        const dt = 1.0 / steps;
                        const points = [];

                        for (let i = 0; i <= steps; ++i) {
                            const t = Math.max(0,Math.min(1,dt * i));
                            const cx = (1-t)*(1-t)*p0.x + 2*t*(1-t)*p1.x + t*t*p2.x;
                            const cy = (1-t)*(1-t)*p0.y + 2*t*(1-t)*p1.y + t*t*p2.y;
                            points.push({x:cx,y:cy});
                        }

                        return points;
                    };

                    const cubic_bezier = (p0, p1, p2, p3, steps = 20) => {
                        const dt = 1.0 / steps;
                        const points = [];

                        for (let i = 0; i <= steps; ++i) {
                            const t = Math.max(0,Math.min(1,dt * i));

                            const B0 = (1-t)*(1-t)*(1-t);
                            const B1 = 3*t*(1-t)*(1-t);
                            const B2 = 3*t*t*(1-t);
                            const B3 = t*t*t;

                            const cx = p0.x*B0+p1.x*B1+p2.x*B2+p3.x*B3;
                            const cy = p0.y*B0+p1.y*B1+p2.y*B2+p3.y*B3;

                            points.push({x:cx,y:cy});
                        }

                        return points;
                    }

                    let px = 0, py = 0, pbx = 0, pby = 0;
                    const s = 25.0;

                    const milling = [];
                    let min_x = 1000, min_y = 1000;
                    let max_x = 0, max_y = 0;

                    const line_to = (ax, ay) => {
                        px = ax;
                        py = ay;
                        ctx.lineTo(s*sx*px+tx,s*sy*py+ty);

                        min_x = Math.min(min_x, px);
                        min_y = Math.min(min_y, py);
                        max_x = Math.max(max_x, px);
                        max_y = Math.max(max_y, py);

                        milling.push({x:s*sx*px+tx,y:s*sy*py+ty,z:0});
                    };

                    const move_to = (ax, ay) => {
                        milling.push({x:s*sx*px+tx,y:s*sy*py+ty,z:5});
                        px = ax;
                        py = ay;
                        pbx = px;
                        pby = py;
                        milling.push({x:s*sx*px+tx,y:s*sy*py+ty,z:5});
                        milling.push({x:s*sx*px+tx,y:s*sy*py+ty,z:0});
                        ctx.moveTo(s*sx*px+tx,s*sy*py+ty);
                    };

                    const draw_segment = (segment) => {
                        for (let i = 0; i < segment.length; ++i) {
                            line_to(segment[i].x, segment[i].y);
                        }
                    };

                    const draw_segment_rel = (segment) => {
                        for (let i = 0; i < segment.length; ++i) {
                            line_to(px + segment[i].x, py + segment[i].y);
                        }
                    };

                    const implicit_line = (relative) => {
                        const points = read_points();
                        
                        if (!relative) {
                            draw_segment(points);
                        } else {
                            draw_segment_rel(points);
                        }
                    };
                    
                    while (commands.length > 0) {
                        const command = commands.shift();
                        console.log(`parsing command: ${command}`);
                        switch(command) {
                            case "M":
                            {
                                const pt = read_point();
                                move_to(pt.x, pt.y);

                                implicit_line(false);
                                break;
                            }

                            case "m":
                            {
                                const pt = read_point();
                                move_to(px + pt.x, py + pt.y);
                                implicit_line(true);
                                break;
                            }

                            case "L":
                            {
                                const pt = read_point();
                                line_to(pt.x, pt.y);
                                implicit_line(false);
                                break;
                            }

                            case "l":
                            {
                                const pt = read_point();
                                line_to(px + pt.x, py + pt.y);
                                implicit_line(true);
                                break;
                            }

                            case "H":
                            {
                                const fx = parseFloat(commands.shift());
                                line_to(fx, py);
                                break;
                            }

                            case "h":
                            {
                                const fx = parseFloat(commands.shift());
                                line_to(px+fx, py);
                                break;
                            }

                            case "V":
                            {
                                const fy = parseFloat(commands.shift());
                                line_to(px, fy);
                                break;
                            }

                            case "v":
                            {
                                const fy = parseFloat(commands.shift());
                                line_to(px, py + fy);
                                break;
                            }

                            case "Q":
                            {
                                const points = read_points();

                                for (let i = 0; i < points.length; i = i + 2) {
                                    const p0 = { x:px, y:py };
                                    const p1 = points[i];
                                    const p2 = points[i+1];
                                    const seg = quadratic_bezier(p0,p1,p2,10);
                                    draw_segment(seg);
                                }

                                break;
                            }

                            case "q":
                            {
                                const points = read_points();

                                for (let i = 0; i < points.length; i = i + 2) {
                                    const p0 = { x:px, y:py };
                                    const p1 = { x:px + points[i].x, y:py + points[i].y};
                                    const p2 = { x:px + points[i+1].x, y:py + points[i+1].y};
                                    const seg = quadratic_bezier(p0,p1,p2,10);
                                    draw_segment(seg);
                                }

                                break;
                            }

                            case "C":
                            {
                                const points = read_points();

                                for (let i = 0; i < points.length; i = i + 3) {
                                    const p0 = { x:px, y:py };
                                    const p1 = points[i];
                                    const p2 = points[i+1];
                                    const p3 = points[i+2];
                                    const seg = cubic_bezier(p0,p1,p2,p3,10);
                                    draw_segment(seg);
                                }

                                break;
                            }

                            case "c":
                            {
                                const points = read_points();

                                for (let i = 0; i < points.length; i = i + 3) {
                                    const p0 = { x:px, y:py };
                                    const p1 = { x:px + points[i].x, y:py + points[i].y};
                                    const p2 = { x:px + points[i+1].x, y:py + points[i+1].y};
                                    const p3 = { x:px + points[i+2].x, y:py + points[i+2].y};
                                    const seg = cubic_bezier(p0,p1,p2,p3,10);
                                    draw_segment(seg);
                                }

                                break;
                            }

                            case "z":
                            case "Z":
                            {
                                line_to(pbx,pby);
                                break;
                            }

                            default:
                                console.error(`unsupported command ${command}`);
                                commands = [];
                                break;
                        }
                    }

                    return milling;
                };

                const milling_paths = [];
                for (const path of paths) {
                    milling_paths.push(gen_paths(cw, ch, path.data, path.sx, path.sy, path.tx, path.ty));
                }

                ctx.stroke();

                ///////////////////////////////////
                // OUTPUT MILLING PATHS
                ///////////////////////////////////
                let buffer = '';
                let line = 3;

                const base_width = 150;
                const base_height = 150;

                const rsx = base_width / cw;
                const rsy = base_height / ch;

                const printl = (iX, iY, iZ) => {
                    const X = iX.toFixed(3);
                    const Y = iY.toFixed(3);
                    const Z = iZ.toFixed(3);

                    buffer += `N${line}G01X${X}Y${Y}Z${Z}\r\n`;
                    line++;
                };
                console.log(milling_paths);

                printl(0,0,93.750);
                const safe_height = 93.750;
                for (const milling of milling_paths) {
                    for (let i = 0; i < milling.length; ++i) {
                        const pt = milling[i];                    
                        
                        let rx = pt.x * rsx - base_width * 0.5;
                        let ry = pt.y * rsy - base_height * 0.5;
                        let rz = pt.z + 17.5;

                        milling[i].x = ry;
                        milling[i].y = rx;
                        milling[i].z = rz;
                    }

                    printl(milling[1].x, milling[1].y, safe_height);
                    
                    for (let i = 1; i < milling.length; ++i) {
                        const rx = milling[i].x;
                        const ry = milling[i].y;
                        const rz = milling[i].z;

                        printl(rx, ry, rz);
                    }

                    const N = milling.length - 1;
                    printl(milling[N].x, milling[N].y, safe_height);
                }

                printl(0,0,93.750);
                const el = document.createElement("textarea");
                el.value = buffer;
                document.body.appendChild(el);

                return canvas;
            };

            window.addEventListener('load', () => {
                const canvas = milling_signature(1000, 1000, [
                    //{ data: logo_curves, sx: 0.007, sy: -0.007, tx: 600, ty: 220 },
                    { data: logo_curves2, sx: 0.0059, sy: -0.0059, tx: 575, ty: 210 },
                    { data: sign_curves2, sx: 0.9, sy: 0.9, tx: 60, ty: 770 }
                ]);
                document.body.appendChild(canvas);
            });
        </script>
    </head>
    <body style="background:#000">
        
    </body>
</html>